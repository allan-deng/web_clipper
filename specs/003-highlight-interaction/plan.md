# 实施计划: 高亮交互优化

**分支**: `003-highlight-interaction` | **日期**: 2025-12-15 | **规范**: [spec.md](./spec.md)
**输入**: 来自 `/specs/003-highlight-interaction/spec.md` 的功能规范

## 摘要

增强网页高亮区域的用户交互体验，包括：悬停显示笔记浮窗、点击编辑笔记、删除高亮/笔记。此功能完全在浏览器端（content script）实现，不涉及后端服务。

**核心技术方法**:
- 使用 mouseenter/mouseleave 事件实现悬停浮窗
- 使用 click 事件实现点击编辑器
- 动态创建 DOM 元素作为浮窗和编辑器
- 使用 getBoundingClientRect() 计算位置
- 使用防抖/延迟处理避免 UI 闪烁

## 技术背景

**语言/版本**: JavaScript ES6+ (Manifest V3)
**主要依赖**: 原生 DOM API, CSS
**存储**: 内存存储 (页面会话级别)
**测试**: 手动测试 (浏览器扩展环境)
**目标平台**: Chrome 88+, Edge 88+ (Manifest V3 兼容)
**项目类型**: 浏览器扩展 (纯前端功能)
**性能目标**: 浮窗显示 < 200ms, 编辑器显示 < 100ms
**约束条件**: 纯前端实现, 不涉及后端, 与现有高亮功能集成
**规模/范围**: 单一功能增量, 主要修改 content.js

## 章程检查

*门控: 必须在阶段 0 研究前通过. 阶段 1 设计后重新检查.*

| 章程原则 | 适用性 | 合规状态 | 说明 |
|----------|--------|----------|------|
| I. 桥接模式架构 | ✅ 适用 | ✅ 通过 | 纯前端 UI 交互，符合"前端负责渲染 UI"原则 |
| II. 数据安全与隐私 | ⚪ 不适用 | N/A | 无网络请求，无资源下载 |
| III. 技术栈选型 | ✅ 适用 | ✅ 通过 | 使用原生 JavaScript，无额外框架依赖 |
| IV. 工程标准 | ⚪ 不适用 | N/A | 无文件写入操作 |
| V. 数据一致性 | ⚪ 不适用 | N/A | 内存存储，无持久化 |
| JavaScript 编码规范 | ✅ 适用 | ✅ 通过 | 使用 async/await，DOM 操作需做空值检查 |

**门控结果**: ✅ 通过 - 无违规项，可继续执行

## 项目结构

### 文档(此功能)

```
specs/003-highlight-interaction/
├── spec.md              # 功能规范
├── plan.md              # 此文件
├── research.md          # 阶段 0 输出
├── data-model.md        # 阶段 1 输出
├── quickstart.md        # 阶段 1 输出
├── contracts/           # N/A (无 API)
└── tasks.md             # 阶段 2 输出
```

### 源代码(仓库根目录)

```
extension/
├── content.js           # [修改] 添加悬停/点击事件处理、浮窗/编辑器逻辑
└── styles/
    └── highlight.css    # [修改] 添加浮窗和编辑器样式
```

**结构决策**: 所有逻辑集中在 content.js，与现有高亮功能代码位于同一文件，便于访问 highlights 数组

## 复杂度跟踪

*无章程违规需要证明*

| 违规 | 为什么需要 | 拒绝更简单替代方案的原因 |
|------|------------|--------------------------|
| 无   | N/A        | N/A                      |

## 设计后章程重检

*阶段 1 设计完成后填写*

| 检查项 | 状态 | 备注 |
|--------|------|------|
| 无后端依赖 | ✅ | 纯前端实现 |
| 原生 JavaScript | ✅ | 无框架依赖 |
| DOM 空值检查 | ✅ | 所有 querySelector 结果需检查 |
