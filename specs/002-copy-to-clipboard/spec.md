# 功能规范: 复制到剪贴板

**功能分支**: `002-copy-to-clipboard`
**创建时间**: 2025-12-14
**状态**: 草稿
**输入**: 用户描述: "新增功能：浏览器插件中增加按钮Copy to clipboard 点击后可以将网页转换为 markdown ，并将 markdown 复制到剪切板，而不访问 backend server 保存到文件。"

## 用户场景与测试 *(必填)*

### 用户故事 1 - 一键复制网页为 Markdown (优先级: P1)

作为一个经常需要收集网页内容的用户，我希望能够点击一个按钮，将当前网页内容转换为 Markdown 格式并复制到剪贴板，这样我可以快速粘贴到任何支持 Markdown 的编辑器中（如 Obsidian、Notion、Typora 等），而无需配置后端服务或网络连接。

**优先级原因**: 这是功能的核心价值，提供了一种轻量级、离线可用的内容采集方式，降低使用门槛。

**独立测试**: 可以通过在任意网页上点击"Copy to clipboard"按钮，然后在文本编辑器中粘贴来完全测试，验证 Markdown 格式正确且内容完整。

**验收场景**: 

1. **给定** 用户正在浏览一篇包含标题、段落和图片的网页，**当** 用户点击扩展弹窗中的"Copy to clipboard"按钮时，**那么** 系统将网页主要内容转换为 Markdown 格式并复制到系统剪贴板，用户可在任何编辑器中粘贴使用。

2. **给定** 用户正在浏览一篇文章，**当** 复制操作成功完成时，**那么** 用户看到明确的成功反馈提示，确认内容已复制。

3. **给定** 用户处于离线状态，**当** 用户点击"Copy to clipboard"按钮时，**那么** 功能正常工作，因为不依赖网络请求。

---

### 用户故事 2 - 包含页面元信息的 Markdown (优先级: P2)

作为一个需要追溯内容来源的用户，我希望复制的 Markdown 内容包含页面的基本元信息（如标题、URL、时间），这样我在后续整理笔记时可以知道内容来源。

**优先级原因**: 元信息对于知识管理和引用追踪至关重要，是完整内容采集的标准实践。

**独立测试**: 可以通过复制网页内容后检查 Markdown 顶部是否包含 YAML frontmatter 或元信息区块来验证。

**验收场景**: 

1. **给定** 用户在任意网页上使用复制功能，**当** 复制完成后，**那么** Markdown 内容顶部包含页面标题、原始 URL 和剪藏时间信息。

---

### 用户故事 3 - 复制失败的错误处理 (优先级: P2)

作为用户，当复制操作因任何原因失败时，我希望看到清晰的错误提示，这样我知道发生了什么问题以及如何处理。

**优先级原因**: 良好的错误处理是用户体验的重要组成部分，帮助用户理解和解决问题。

**独立测试**: 可以通过模拟权限不足或内容提取失败的场景来验证错误提示是否正确显示。

**验收场景**: 

1. **给定** 系统无法访问剪贴板（如权限被拒绝），**当** 用户点击复制按钮时，**那么** 用户看到友好的错误提示，说明无法复制到剪贴板。

2. **给定** 当前页面无法提取有效内容（如空白页或受限页面），**当** 用户点击复制按钮时，**那么** 用户看到提示说明无法从该页面提取内容。

---

### 边界情况

- 当页面内容非常长（超过 100,000 字符）时会发生什么？系统应正常处理并复制完整内容。
- 当页面包含复杂表格或代码块时会发生什么？系统应尽可能保留格式转换为 Markdown。
- 当页面是纯图片或视频页面（无文字内容）时会发生什么？系统应提示用户该页面没有可提取的文本内容。
- 当用户快速多次点击复制按钮时会发生什么？系统应防止重复执行，直到上一次操作完成。

## 需求 *(必填)*

### 功能需求

- **FR-001**: 扩展弹窗界面必须显示一个明确标识的"Copy to clipboard"按钮
- **FR-002**: 系统必须能够提取当前网页的主要内容（标题、正文、图片引用）
- **FR-003**: 系统必须将提取的内容转换为有效的 Markdown 格式
- **FR-004**: 系统必须将转换后的 Markdown 文本复制到系统剪贴板
- **FR-005**: 复制操作必须完全在浏览器端完成，不得发起任何网络请求
- **FR-006**: 系统必须在复制成功后向用户显示成功反馈
- **FR-007**: 系统必须在复制失败时向用户显示错误信息
- **FR-008**: 复制的 Markdown 必须包含页面元信息（标题、URL、剪藏时间）
- **FR-009**: 系统必须在操作进行中禁用按钮以防止重复点击
- **FR-010**: 按钮状态必须在操作完成后恢复

### 关键实体

- **剪藏内容 (ClippedContent)**: 从网页提取的结构化内容，包含标题、正文（Markdown 格式）、原始 URL、剪藏时间戳
- **操作状态 (OperationStatus)**: 表示复制操作的当前状态，包括空闲、进行中、成功、失败

## 成功标准 *(必填)*

### 可衡量的结果

- **SC-001**: 用户可以在 3 秒内完成从点击按钮到内容复制成功的完整流程（普通长度文章）
- **SC-002**: 复制的 Markdown 在主流 Markdown 编辑器（Obsidian、Typora、VS Code）中正确渲染
- **SC-003**: 功能在无网络连接的情况下 100% 可用
- **SC-004**: 用户首次使用无需任何配置即可成功复制内容
- **SC-005**: 95% 的网页内容能够被成功提取和转换（基于主流新闻、博客、文档类网站测试）

## 假设

- 用户使用的浏览器支持 Clipboard API（现代 Chrome/Edge 均支持）
- 用户已授予扩展必要的权限
- 复制功能复用现有的内容提取和 Markdown 转换逻辑（与"Save to Obsidian"功能共享）
- 图片在 Markdown 中以原始 URL 引用形式保留，不进行 Base64 嵌入（保持 Markdown 简洁）
